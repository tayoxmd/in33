# ุฏููู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงูู ูู Supabase
# Complete Supabase Database Setup Guide

## ๐ ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅูุดุงุก ููู SQL ุดุงูู ูุญุชูู ุนูู ุฌููุน ุงูุฌุฏุงูู ูุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ ูุชุทุจููู.

## ๐ ุงููููุงุช ุงููุทููุจุฉ
- `setup_supabase_complete.sql` - ููู SQL ุดุงูู ูุญุชูู ุนูู ุฌููุน ุงูุฌุฏุงูู ูุงูุฅุนุฏุงุฏุงุช

## ๐ ุฎุทูุงุช ุงูุชูููุฐ

### ุงูุฎุทูุฉ 1: ูุชุญ Supabase SQL Editor
1. ุงูุชุญ [Supabase Dashboard](https://supabase.com/dashboard)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ูู ุงูุดุฑูุท ุงูุฌุงูุจูุ ุงููุฑ ุนูู **"SQL Editor"**

### ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุงุณุชุนูุงู ุฌุฏูุฏ
1. ูู ุงูุฌุฒุก ุงูุนููู ูู ููุทูุฉ ุงููุญุชููุ ุจุฌูุงุฑ ุดุฑูุท ุงูุจุญุซุ ุงููุฑ ุนูู ุฒุฑ **`+` (ุนูุงูุฉ ุฒุงุฆุฏ)**
2. ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉุ ุงุฎุชุฑ **"Create a new snippet"** (ุฅูุดุงุก ููุชุทู ุฌุฏูุฏ)

### ุงูุฎุทูุฉ 3: ูุณุฎ ุงูููุฏ
1. ุงูุชุญ ููู `setup_supabase_complete.sql` ูู ูุฌูุฏ `home`
2. ุงูุณุฎ **ุฌููุน** ูุญุชููุงุช ุงูููู (Ctrl+A ุซู Ctrl+C)
3. ุงูุตู ุงูููุฏ ูู ูุญุฑุฑ SQL ูู Supabase

### ุงูุฎุทูุฉ 4: ุชุดุบูู ุงูุงุณุชุนูุงู
1. ุงููุฑ ุนูู ุฒุฑ **"Run"** (ุชุดุบูู) ูู ุงูุฃุณูู
2. ุฃู ุงุถุบุท **`Ctrl+Enter`** ุนูู ููุญุฉ ุงูููุงุชูุญ
3. ุงูุชุธุฑ ุญุชู ุชุธูุฑ ุฑุณุงูุฉ **"Success"**

### ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ุงููุชุงุฆุฌ
1. ูู ุงูุดุฑูุท ุงูุฌุงูุจูุ ุงููุฑ ุนูู **"Table Editor"**
2. ุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุฌุฏุงูู ุงูุชุงููุฉ:
   - `profiles`
   - `user_roles`
   - `cities`
   - `hotels`
   - `bookings`
   - `emails`
   - `email_settings`
   - `tasks`
   - `task_categories`
   - `site_settings`
   - `whatsapp_settings`
   - ูุบูุฑูุง...

## โ ูุง ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู

### 1. ุงูุฃููุงุน (ENUMs)
- `booking_status` - ุญุงูุงุช ุงูุญุฌูุฒุงุช
- `complaint_status` - ุญุงูุงุช ุงูุดูุงูู
- `app_role` - ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู
- `task_status` - ุญุงูุงุช ุงูููุงู
- `task_category` - ูุฆุงุช ุงูููุงู

### 2. ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ
- **ุงููุณุชุฎุฏููู**: `profiles`, `user_roles`
- **ุงูููุงุฏู**: `cities`, `hotels`, `hotel_responsible_persons`, `room_availability`
- **ุงูุญุฌูุฒุงุช**: `bookings`, `complaints`, `reviews`
- **ุงูุจุฑูุฏ**: `emails`, `email_settings`
- **ุงูููุงู**: `tasks`, `task_comments`, `task_attachments`, `task_activity_log`, `task_categories`
- **ุงูุฅุนุฏุงุฏุงุช**: `site_settings`, `whatsapp_settings`
- **ุงูุนุฑูุถ**: `coupons`, `coupon_users`, `coupon_hotels`, `loyalty_points`
- **ุงูุญุณุงุจุงุช ุงูุฎุงุตุฉ**: `private_account_access`, `private_owners`, `private_hotels`, `private_rooms`, `private_transactions`, `private_vault`, `private_customers`, `private_bookings`
- **ุงููุงููุฉ**: `financial_transactions`

### 3. ุงูุฏูุงู ุงููุณุงุนุฏุฉ (Functions)
- `update_updated_at_column()` - ุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู
- `has_role()` - ุงูุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู
- `has_any_role()` - ุงูุชุญูู ูู ุฃู ุฏูุฑ ูู ุงูุฃุฏูุงุฑ
- `check_room_availability()` - ุงูุชุญูู ูู ุชููุฑ ุงูุบุฑู
- `calculate_task_remaining_amount()` - ุญุณุงุจ ุงููุจูุบ ุงููุชุจูู ููููุงู ุงููุงููุฉ

### 4. ุงูุณูุงุณุงุช (RLS Policies)
- ุชู ุชูุนูู **Row Level Security (RLS)** ุนูู ุฌููุน ุงูุฌุฏุงูู
- ุชู ุฅูุดุงุก ุณูุงุณุงุช ุงููุตูู ุงูููุงุณุจุฉ ููู ุฌุฏูู
- ุงููุณุชุฎุฏููู ูููููู ุงููุตูู ููุท ุฅูู ุจูุงูุงุชูู
- ุงููุฏุฑุงุก ูููููู ุงููุตูู ุฅูู ุฌููุน ุงูุจูุงูุงุช

### 5. ุงูููุงุฑุณ (Indexes)
- ููุงุฑุณ ุนูู ุงูุฃุนูุฏุฉ ุงููุณุชุฎุฏูุฉ ุจูุซุฑุฉ ููุชุญุณูู ูู ุงูุฃุฏุงุก
- ููุงุฑุณ ุนูู `account_id`, `folder`, `date` ูู ุฌุฏูู `emails`
- ููุงุฑุณ ุนูู `user_id`, `hotel_id`, `status` ูู ุฌุฏูู `bookings`
- ููุงุฑุณ ุนูู `assigned_to`, `status`, `category` ูู ุฌุฏูู `tasks`

### 6. ุงููุญูุฒุงุช (Triggers)
- ูุญูุฒุงุช ูุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู ุนูู ุฌููุน ุงูุฌุฏุงูู
- ูุญูุฒ ูุญุณุงุจ ุงููุจูุบ ุงููุชุจูู ููููุงู ุงููุงููุฉ

### 7. ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ
- ุฅุนุฏุงุฏุงุช ุงููููุน ุงูุงูุชุฑุงุถูุฉ (ุถุฑูุจุฉ 15%)
- ุฅุนุฏุงุฏุงุช WhatsApp ุงูุงูุชุฑุงุถูุฉ
- ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุงูุชุฑุงุถูุฉ
- ูุฆุงุช ุงูููุงู ุงูุงูุชุฑุงุถูุฉ (ุนุงูุฉุ ูุงููุฉุ ุญุฌูุฒุงุชุ ุฏุนูุ ุตูุงูุฉ)
- ุฅุนุฏุงุฏุงุช ูุดุงุฑูุฉ ุงูููุงู ุงูุงูุชุฑุงุถูุฉ
- ุงูุฎุฒูุฉ ุงูุฎุงุตุฉ ุงูุงูุชุฑุงุถูุฉ (0)

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงููุณุฎ ุงูุงุญุชูุงุทู**: ูุจู ุชุดุบูู ุงูุงุณุชุนูุงูุ ุชุฃูุฏ ูู ุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
2. **ุงูุฃุฎุทุงุก**: ุฅุฐุง ุธูุฑุช ุฃุฎุทุงุกุ ูุฏ ุชููู ุจุนุถ ุงูุฌุฏุงูู ููุฌูุฏุฉ ุจุงููุนู. ูุฐุง ุทุจูุนู ููุง ูุคุซุฑ ุนูู ุงูุนูููุฉ
3. **ุงูููุช**: ูุฏ ุชุณุชุบุฑู ุงูุนูููุฉ ุจุถุน ุฏูุงุฆู ุญุณุจ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. **ุงูุชุญูู**: ุจุนุฏ ุงูุงูุชูุงุกุ ุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุฌุฏุงูู ูู "Table Editor"

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "relation already exists"
- ูุฐุง ูุนูู ุฃู ุงูุฌุฏูู ููุฌูุฏ ุจุงููุนู
- ุงูููู ูุณุชุฎุฏู `CREATE TABLE IF NOT EXISTS` ูุฐูู ูู ูุณุจุจ ูุดุงูู
- ููููู ุชุฌุงูู ูุฐุง ุงูุฎุทุฃ

### ุฎุทุฃ: "type already exists"
- ูุฐุง ูุนูู ุฃู ุงูููุน (ENUM) ููุฌูุฏ ุจุงููุนู
- ุงูููู ูุณุชุฎุฏู `DO $$ BEGIN ... EXCEPTION ... END $$` ูุฐูู ูู ูุณุจุจ ูุดุงูู
- ููููู ุชุฌุงูู ูุฐุง ุงูุฎุทุฃ

### ุฎุทุฃ: "policy already exists"
- ูุฐุง ูุนูู ุฃู ุงูุณูุงุณุฉ ููุฌูุฏุฉ ุจุงููุนู
- ุงูููู ูุณุชุฎุฏู `DROP POLICY IF EXISTS` ูุจู ุฅูุดุงุก ุงูุณูุงุณุฉ
- ููููู ุชุฌุงูู ูุฐุง ุงูุฎุทุฃ

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ูู Supabase
2. ุชุฃูุฏ ูู ุฃู ุฌููุน ุงูุฌุฏุงูู ุชู ุฅูุดุงุคูุง ุจูุฌุงุญ
3. ุชุญูู ูู ุฃู RLS ููุนู ุนูู ุฌููุน ุงูุฌุฏุงูู

## โ ุจุนุฏ ุงูุงูุชูุงุก

ุจุนุฏ ุชุดุบูู ุงูุงุณุชุนูุงู ุจูุฌุงุญ:
1. ุงุฑุฌุน ุฅูู ุชุทุจููู
2. ุงุถุบุท `Ctrl+Shift+R` ูุฅุนุงุฏุฉ ุงูุชุญููู ุงููุงูู
3. ูุฌุจ ุฃู ูุนูู ุงูุชุทุจูู ุจุดูู ุตุญูุญ ุงูุขู

---

**ููุงุญุธุฉ**: ูุฐุง ุงูููู ุดุงูู ููุญุชูู ุนูู ุฌููุน ุงูุฌุฏุงูู ูุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ. ููููู ุชุดุบููู ูุฑุฉ ูุงุญุฏุฉ ููุท ูุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงููุงูู.

