# دليل إنشاء جدول البريد في Supabase

## المشكلة
جدول `emails` غير موجود في قاعدة البيانات Supabase، مما يمنع صفحة البريد من العمل.

## الحل: إنشاء الجدول يدوياً

### الطريقة 1: استخدام Supabase Dashboard (الأسهل)

1. **افتح Supabase Dashboard:**
   - اذهب إلى https://supabase.com/dashboard
   - سجل الدخول إلى حسابك
   - اختر مشروعك

2. **افتح SQL Editor:**
   - من القائمة الجانبية اليسرى، انقر على "SQL Editor"
   - انقر على "New query" لإنشاء استعلام جديد

3. **انسخ والصق الكود:**
   - افتح ملف `home/create_emails_table.sql`
   - انسخ المحتوى بالكامل
   - الصقه في SQL Editor

4. **شغّل الاستعلام:**
   - انقر على زر "Run" أو اضغط `Ctrl+Enter`
   - يجب أن ترى رسالة نجاح في الأسفل

5. **تحقق من الجدول:**
   - من القائمة الجانبية، انقر على "Table Editor"
   - يجب أن ترى جدول `emails` في القائمة

### الطريقة 2: استخدام Supabase CLI

إذا كان لديك Supabase CLI مثبت:

```bash
# تأكد من أنك في مجلد المشروع
cd home

# شغّل ملف migration
supabase db push
```

أو شغّل ملف SQL مباشرة:

```bash
supabase db execute -f create_emails_table.sql
```

## بعد إنشاء الجدول

1. **أعد تحميل صفحة البريد:**
   - اضغط `Ctrl+Shift+R` لمسح الكاش وإعادة التحميل
   - يجب أن تختفي رسالة الخطأ

2. **تحقق من عمل الصفحة:**
   - يجب أن تعمل صفحة البريد بشكل طبيعي
   - يجب أن يعمل نظام السحب والإفلات
   - يجب أن يعمل نظام التصفية

## ملاحظات مهمة

- **RLS (Row Level Security):** الجدول مفعّل عليه RLS، لكن السياسة الحالية تسمح لجميع المستخدمين بالوصول
- **الفهارس:** تم إنشاء فهارس على `account_id` و `folder` و `date` لتحسين الأداء
- **البيانات:** الجدول فارغ في البداية، سيتم ملؤه عند إرسال أو استقبال البريد

## استكشاف الأخطاء

إذا واجهت مشاكل:

1. **خطأ في الصلاحيات:**
   - تأكد من أنك مسجل الدخول كـ admin في Supabase
   - تأكد من أن لديك صلاحيات إنشاء الجداول

2. **الجدول موجود بالفعل:**
   - إذا كان الجدول موجوداً، سيتم تجاهل الأمر `CREATE TABLE IF NOT EXISTS`
   - لا تقلق، لن يحدث أي ضرر

3. **خطأ في الصيغة:**
   - تأكد من نسخ الكود بالكامل من ملف `create_emails_table.sql`
   - تأكد من عدم وجود أخطاء إملائية

## الدعم

إذا استمرت المشكلة، تحقق من:
- Console في المتصفح (F12) للأخطاء
- Supabase Dashboard > Logs للأخطاء من قاعدة البيانات
- ملف `create_emails_table.sql` للتأكد من صحة الكود


